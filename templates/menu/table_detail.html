{% extends "base.html" %}
{% block content %}
<a href="{% url 'book_table' %}" class="btn btn-light shadow-sm mb-4">
    ‚¨ÖÔ∏è Back to Table List
</a>

<div class="container my-5">
    <div class="row">
        <div class="col-md-6">
            {% if table.image %}
                <img src="{{ table.image.url }}" class="img-fluid rounded-4 shadow" alt="Table Image">
            {% endif %}
        </div>

        <div class="col-md-6">
            <h2 class="fw-bold">Table {{ table.table_number }}</h2>
            <p class="text-muted">{{ table.description }}</p>

            <span class="badge bg-primary mb-3">
                üë• {{ table.seats }} Seats
            </span>

            <h5 class="mt-4">üìÖ Book this Table</h5>

            <form method="post">
                {% csrf_token %}
                <label class="small text-muted">Select Date:</label>
                <input type="date" id="bookingDate" name="date" class="form-control mb-3" required>

                <label class="small text-muted">Select Time Slot (30-min intervals):</label>
                <select name="time" class="form-select mb-3" required>
                    <option value="" disabled selected>Choose a time...</option>
                    <option value="10:00">10:00 AM</option>
                    <option value="10:30">10:30 AM</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="11:30">11:30 AM</option>
                    <option value="12:00">12:00 PM</option>
                    <option value="12:30">12:30 PM</option>
                    <option value="13:00">01:00 PM</option>
                    <option value="13:30">01:30 PM</option>
                    <option value="14:00">02:00 PM</option>
                    <option value="14:30">02:30 PM</option>
                    <option value="15:00">03:00 PM</option>
                    <option value="15:30">03:30 PM</option>
                    <option value="16:00">04:00 PM</option>
                    <option value="16:30">04:30 PM</option>
                    <option value="17:00">05:00 PM</option>
                    <option value="17:30">05:30 PM</option>
                    <option value="18:00">06:00 PM</option>
                    <option value="18:30">06:30 PM</option>
                    <option value="19:00">07:00 PM</option>
                    <option value="19:30">07:30 PM</option>
                    <option value="20:00">08:00 PM</option>
                    <option value="20:30">08:30 PM</option>
                    <option value="21:00">09:00 PM</option>
                    <option value="21:30">09:30 PM</option>
                    <option value="22:00">10:00 PM</option>
                </select>

                <button type="submit" class="btn btn-warning w-100 fw-bold shadow-sm">
                    Confirm Booking
                </button>
            </form>

            <hr>

            {% if user.is_authenticated %}
                <a href="{% url 'add_table_review' table.id %}"
                   class="btn btn-outline-primary w-100 mt-2">
                    Leave a Review
                </a>
            {% endif %}
        </div>
    </div>

    <hr class="my-4">

    <h4>‚≠ê Customer Reviews</h4>

    {% for review in reviews %}
        <div class="border rounded p-3 mb-2 shadow-sm bg-light">
            <strong>{{ review.user.username }}</strong>
            <div class="text-warning">
                {% for i in "12345"|slice:":review.rating" %}‚≠ê{% endfor %}
            </div>
            <p class="mb-0 mt-1">{{ review.comment }}</p>
        </div>
    {% empty %}
        <p class="text-muted">No reviews yet. Be the first to review this table!</p>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('bookingDate');
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);
    });
</script>

{% endblock %}