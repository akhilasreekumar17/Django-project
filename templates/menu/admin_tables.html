{% extends "base.html" %}
{% block content %}

<div class="container my-5">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>ğŸª‘ Table Management</h2>
        <a href="{% url 'add_table' %}" class="btn btn-success">
            + Add Table
        </a>
    </div>

    <div class="row g-4">
        {% for table in tables %}
        <div class="col-md-4">

            <div class="card shadow h-100">

                <!-- IMAGE -->
                {% if table.image %}
                    <img src="{{ table.image.url }}"
                         class="card-img-top"
                         style="height:200px; object-fit:cover;">
                {% endif %}

                <div class="card-body d-flex flex-column">

                    <!-- BASIC INFO -->
                    <h5 class="mb-1">Table {{ table.table_number }}</h5>
                    <p class="mb-1">ğŸ‘¥ Seats: {{ table.seats }}</p>
                    <p class="mb-1">â­ Rating: {{ table.average_rating }}</p>

                    <span class="badge mb-3 {% if table.is_active %}bg-success{% else %}bg-danger{% endif %}">
                        {% if table.is_active %}Active{% else %}Inactive{% endif %}
                    </span>

                    <!-- BOOKINGS -->
                    <hr>
                    <h6 class="mb-2">ğŸ“… Upcoming Bookings</h6>

                    {% with bookings=table.bookings.all %}
                        {% if bookings %}
                            <ul class="list-unstyled small">
                                {% for booking in bookings %}
                                    {% if booking.date >= today %}
                                        <li class="mb-2">
                                            ğŸ—“ <strong>{{ booking.date }}</strong><br>
                                            â° {{ booking.time|time:"H:i" }}<br>
                                            ğŸ‘¤ {{ booking.user.username }}
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted small">No bookings yet</p>
                        {% endif %}
                    {% endwith %}

                    <!-- ACTIONS -->
                    <div class="mt-auto">
                        <a href="{% url 'edit_table' table.id %}"
                           class="btn btn-sm btn-primary w-100 mt-2">
                            Edit Table
                        </a>
                    </div>

                </div>
            </div>

        </div>
        {% empty %}
            <p class="text-muted">No tables added yet.</p>
        {% endfor %}
    </div>

</div>

{% endblock %}
